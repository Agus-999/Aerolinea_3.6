{% extends "base.html" %}
{% load static %}

{% block content %}
<style>
.container { max-width: 1200px; }
h2 { text-align: center; color: #0d6efd; font-weight: 700; margin-bottom: 30px; }

/* Card filtros */
.card { padding: 20px; border-radius: 12px; margin-bottom: 20px; background-color: #f8f9fa; }

/* Inputs y selects */
.form-control, .form-select { border-radius: 8px; transition: 0.3s; }
.form-control:focus, .form-select:focus { border-color: #0d6efd; box-shadow: 0 0 5px rgba(13,110,253,0.5); }

/* Botón */
.btn-primary { background-color: #0d6efd; border-radius: 8px; font-weight: 600; }
.btn-primary:hover { background-color: #0b5ed7; }

/* Tabla */
.table { border-radius: 12px; overflow: hidden; }
.table thead { background-color: #0d6efd; color: white; }
.table-hover tbody tr:hover { background-color: #e2e6ea; }

.filtros-row { display: flex; gap: 10px; flex-wrap: wrap; }
.filtros-row .col, .filtros-row .col-auto { flex: 1 1 auto; }
</style>

<div class="container mt-5">
    <h2>Reporte de Reservas</h2>

    <!-- Filtros -->
    <div class="card shadow-sm">
        <form method="get" class="filtros-row align-items-end">
            <div class="col">
                <label class="form-label fw-bold">Vuelo</label>
                <select name="vuelo" class="form-select">
                    <option value="">Todos los vuelos</option>
                    {% for id, vuelo_text in vuelos %}
                        <option value="{{ id }}" {% if filtros.vuelo == id|stringformat:"s" %}selected{% endif %}>
                            {{ vuelo_text }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col">
                <label class="form-label fw-bold">Buscar pasajero</label>
                <input type="text" name="buscar" class="form-control" placeholder="Nombre del pasajero..." value="{{ filtros.buscar }}">
            </div>
            <div class="col-auto">
                <button type="submit" class="btn btn-primary w-100">Filtrar</button>
            </div>
        </form>
    </div>

    <!-- Tabla de reservas -->
    <div class="table-responsive shadow-sm rounded mt-3">
        <table class="table table-hover align-middle text-center">
            <thead>
                <tr>
                    <th>Vuelo</th>
                    <th>Pasajero</th>
                    <th>Documento</th>
                    <th>Asientos</th>
                    <th>Estado</th>
                    <th>Fecha de reserva</th>
                    <th>Precio</th>
                </tr>
            </thead>
            <tbody>
                {% for r in reservas %}
                <tr class="{% if r.estado == 'ocupado' %}table-danger{% else %}table-success{% endif %}">
                    <td>{{ r.vuelo.origen }} → {{ r.vuelo.destino }}</td>
                    <td>{{ r.pasajero.nombre }}</td>
                    <td>{{ r.pasajero.documento }}</td>
                    <td>
                        {% if r.asientos.exists %}
                            {{ r.asientos_str }}
                        {% else %}
                            No asignado
                        {% endif %}
                    </td>
                    <td>{{ r.estado|title }}</td>
                    <td>{{ r.fecha_reserva|date:"d \\d\\e F \\d\\e Y \\a \\l\\a H:i" }}</td>
                    <td>${{ r.precio }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" class="text-center text-muted">No hay reservas para mostrar.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
