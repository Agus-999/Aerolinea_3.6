{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="ticket no-print">
  <button class="btn btn-primary" onclick="window.print()">⬇️ Descargar PDF</button>
  <a href="{% url 'gestion:detalle_reserva' reserva.id %}" class="btn btn-secondary ms-2">← Volver</a>
</div>

<div class="ticket">
  <div class="ticket-header">
    <h2>Boleto de Vuelo</h2>
    <div class="ticket-brand">Aerolínea • Sistema de Reservas</div>
  </div>

  <div class="ticket-body">
    <div class="row">
      <div class="col">
        <h4>Reserva</h4>
        <p><strong>Código de reserva:</strong> {{ reserva.codigo_reserva }}</p>
        <p><strong>Fecha emisión:</strong> {{ boleto.fecha_emision|date:"d/m/Y H:i" }}</p>
        <p><strong>Estado boleto:</strong> {{ boleto.get_estado_display }}</p>
      </div>
      <div class="col">
        <h4>Vuelo</h4>
        <p><strong>Vuelo:</strong> {{ reserva.vuelo }}</p>
        {% if reserva.vuelo.origen or reserva.vuelo.destino %}
          <p><strong>Ruta:</strong> {{ reserva.vuelo.origen }} → {{ reserva.vuelo.destino }}</p>
        {% endif %}
        <p><strong>Salida:</strong> {{ reserva.vuelo.fecha_salida|date:"d/m/Y H:i" }}</p>
        <p><strong>Llegada:</strong> {{ reserva.vuelo.fecha_llegada|date:"d/m/Y H:i" }}</p>
      </div>
      <div class="col">
        <h4>Pasajero</h4>
        <p><strong>Nombre:</strong> {{ reserva.pasajero.nombre }}</p>
        <p><strong>Documento:</strong> {{ reserva.pasajero.documento }}</p>
        <p><strong>Email:</strong> {{ reserva.pasajero.email|default:"—" }}</p>
        <p><strong>Teléfono:</strong> {{ reserva.pasajero.telefono|default:"—" }}</p>
      </div>
    </div>

    <div class="row mt-3">
      <div class="col">
        <h4>Asientos</h4>
        {% if asientos %}
          <ul class="seat-list">
            {% for a in asientos %}
              <li>{{ a.numero }} ({{ a.tipo|title }})</li>
            {% endfor %}
          </ul>
        {% else %}
          <p>Sin asientos asignados.</p>
        {% endif %}
      </div>
      <div class="col">
        <h4>Pago</h4>
        <p><strong>Total:</strong> ${{ reserva.precio|default:"0.00" }}</p>
        <p><strong>Estado reserva:</strong> {{ reserva.get_estado_display }}</p>
      </div>
    </div>

    <div class="barcode-block">
      <div class="barcode-label">Código de barra</div>
      <div class="barcode">{{ boleto.codigo_barra }}</div>
      <div class="barcode-note">Presentar junto con documento válido</div>
    </div>
  </div>

  <div class="ticket-footer">
    <small>Este boleto es válido únicamente para el vuelo y pasajero indicados. © {{ now|date:"Y" }}</small>
  </div>
</div>

<style>
  .ticket { max-width: 900px; margin: 0 auto; background: #fff; padding: 24px; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,.06); }
  .ticket-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:16px; }
  .ticket-header h2 { margin:0; }
  .ticket-brand { font-weight:600; opacity:.7; }
  .ticket-body .row { display:grid; grid-template-columns:1fr 1fr 1fr; gap:16px; }
  .ticket-body .col { background:#fafafa; border:1px solid #eee; border-radius:12px; padding:12px 14px; }
  .seat-list { margin:0; padding-left:18px; }
  .barcode-block { margin-top:18px; text-align:center; }
  .barcode-label { font-size:12px; opacity:.7; margin-bottom:6px; }
  .barcode { font-family: monospace; font-size: 20px; letter-spacing: 2px; border: 2px solid #000; padding: 8px 12px; display:inline-block; }
  .barcode-note { font-size:12px; opacity:.7; margin-top:6px; }
  .ticket-footer { margin-top:16px; text-align:center; opacity:.7; }
  .no-print { margin: 12px auto; max-width: 900px; display:flex; align-items:center; gap:8px; }
  @media print {
    .no-print { display: none !important; }
    body { background: #fff !important; }
    @page { size: A4; margin: 12mm; }
    .ticket { box-shadow:none; border: none; }
  }
</style>
{% endblock %}
